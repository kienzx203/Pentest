<?php
session_start();
require_once('helpers.php');
if (isset($_POST['username']) && isset($_POST['password'])) {
    $name = $_POST['username'];
    $password = $_POST['password'];
    $query = "SELECT * FROM users WHERE name='$name' AND password='$password';";

    require_once('connectdb.php');
    $db = connectdb();
    $result = mysqli_query($db, $query);

    if (mysqli_num_rows($result) > 0) {
        $_SESSION['login_error'] = true;
    } else {
        $query = "INSERT INTO users (name, email, password, role) VALUES ('$name', 'test@mail.ch', '$password', 'consumer');";
        $result = mysqli_query($db, $query);
        header('Location: login.php');

    }
    mysqli_close($db);

}
?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <title>Login</title>
</head>

<body>
    <section class=" text-center text-lg-start">
        <style>
            .rounded-t-5 {
                border-top-left-radius: 0.5rem;
                border-top-right-radius: 0.5rem;
            }

            @media (min-width: 992px) {
                .rounded-tr-lg-0 {
                    border-top-right-radius: 0;
                }

                .rounded-bl-lg-5 {
                    border-bottom-left-radius: 0.5rem;
                }
            }
        </style>
        <div class="card mb-3">
            <div class="row g-0 d-flex align-items-center">
                <div class="col-lg-4 d-none d-lg-flex">
                    <img src="https://mdbootstrap.com/img/new/ecommerce/vertical/004.jpg" alt="Trendy Pants and Shoes"
                        class="w-100 rounded-t-5 rounded-tr-lg-0 rounded-bl-lg-5" />
                </div>
                <div class="col-lg-8">
                    <div class="card-body py-5 px-md-5">
                        <form action="" method="post">
                            <div class="form-outline mb-4">
                                <input type="username" name="username" id="form2Example1" class="form-control"
                                    placeholder="Email address" />
                            </div>
                            <div class="form-outline mb-4">
                                <input type="password" name="password" id="form2Example2" class="form-control"
                                    placeholder="Password" />
                            </div>
                    </div>
                    <button type="submit" class="btn mx-auto btn-primary btn-block mb-4" style="width: 200px;">Sign
                        up</button>
                    </form>
                    <?php
                    if (isset($_SESSION['login_error'])) {
                        unset($_SESSION['login_error']);
                        ?>
                        <div class="alert alert-danger" role="alert">
                            Register Failed. Username already exists.
                        </div>
                        <?php
                    }
                    ?>
                </div>
            </div>
        </div>
        </div>
    </section>
</body>

</html>